{{ define "backend" }}
{{-   $be := index . "backend" }}
{{-   $Cfg := index . "Cfg" }}
backend {{ $be.Name }}
{{-  with $be.Members }}
{{-    range $j, $m := . }}
    server {{ $m.Name }} {{ ipport $m.Name }}
{{-        templateIfExists $m.Name $m }}
{{-    end }}
{{   end }}
{{ end }}

{{ define "pool" }}
{{-   range $i, $v := index .Cfg.LtmPool -}}
{{      comment $v.Original 0 }}
{{-     template "backend" (dict "backend" $v "Cfg" $.Cfg) }}
{{-   end }}
{{ end }}
