{{ define "server" }}
{{-   $members := index . "members" }}
{{-   $root := index . "root" }}
{{-   range $j, $member := $members }}
{{-      with index $root.F5config.LtmNode (stripport $member.Name) }}
{{-         templateIndent 4 "block_original" ( dict "block" . "type" "node" )}}
{{-      end }}
    server {{ $member.Name }} {{ ipport $member.Name }}
{{-    end }}
{{ end }}

{{ define "monitor" }}
{{-   $monitors := index . "monitors" }}
{{-   $root := index . "root" }}
{{-   range $j, $monitor := $monitors }}
{{-      with index $root.F5config.LtmMonitor $monitor }}
{{-         templateIndent 4 "block_original" ( dict "block" . "type" "monitor" )}}
{{-      else }}
    ### No definition found for monitor {{ $monitor }}
{{-      end }}
{{-    end }}
{{ end }}

{{ define "backend" }}
{{-   $be := index . "backend" }}
{{-   $root := index . "root" }}
backend {{ $be.Name }}
{{-  with $be.Monitor }}
{{     template "monitor" ( dict "monitors" . "root" $root ) }}
{{-  end }}
{{-  with $be.Members }}
{{     template "server" ( dict "members" . "root" $root ) }}
{{-  end }}
{{- end }}

{{ define "pool" }}
{{-   range $i, $backend := index .F5config.LtmPool -}}
{{-     template "block_original" ( dict "block" $backend "type" "pool" "root" $ ) }}
{{-     template "backend" ( dict "backend" $backend "root" $ ) }}
{{-   end }}
{{ end }}
