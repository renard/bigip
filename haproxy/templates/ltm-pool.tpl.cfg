
{{/*
# block_pool converts a F5Pool into HAProxy backend.
#
# * monitors are taken from their original templates
# * monitors are conserverted as basic server lines
#
*/}}
{{ define "block_pool" }}
{{-   $block := index . "block" }}
{{-   $root := (index . "root").F5config }}
backend {{ $block.Name }}
{{-  with $block.Monitor }}
{{-    range $i, $monitor := . }}
{{ printf "{{   templateIndent 4 \"monitor:%s\" \"\" }}" $monitor  }}
{{-    end }}
{{-  end }}
{{-  with $block.Members }}
{{-    range $i, $member := . }}
{{-      $node := (index (split $member.Name ":") 0) }}
{{-      with (index $root.LtmNode $node) }}
{{-        $address := (index (split .Address "%") 0) }}
{{         printf "{{   templateIndent 4 \"node:%s\" \"\" }}" $node  }}
    server {{ with .Description }}{{ . }}{{ else }}{{ .Name }}{{ end }} {{ $address }}:{{ index (split $member.Name ":") 1 }} check
{{-      else }}
    server {{ $member.Name }} {{ $member.Address }}:{{ index (split $member.Name ":") 1 }}
{{-      end }}
{{-    end }}
{{-  end }}
{{- end }}
