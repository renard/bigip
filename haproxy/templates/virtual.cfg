{{- define "virtual" }}
{{-  range $i, $v :=  index .Cfg.LtmVirtual -}}
{{     comment $v.Original 0 }}
{{-    template "frontend" (dict "frontend" $v "Cfg" $.Cfg ) -}}
{{   end -}}
{{ end -}}


{{ define "frontend" }}
{{-   $fe := index . "frontend" }}
{{-   $Cfg := index . "Cfg" }}
frontend {{ $fe.Name }}
    bind {{ ipport $fe.Destination }}

{{    range $pi, $pn := index $fe.Profiles }}
    ## profile: {{ $pn.Name }}
{{-      with index $Cfg.LtmProfile $pn.Name }}
    # {{ index .OriginalConfig.Lines 0 }}-{{ index .OriginalConfig.Lines 1 }}
{{        comment .Original 4 }}
{{-       templateIfExists $pn.Name . -}}
{{-      end }}
    ## /profile: {{ $pn.Name }}
{{    end }}{{/* end of profile */}}

{{    range $ri, $rn := index $fe.Rules }}
{{-     with index $Cfg.LtmRule $rn }}
{{-       if hasTemplate $rn }}
{{-         templateIfExists $rn . -}}
{{-       else }}
    ## rule: {{ $rn }}
{{          comment .Original 4 }}
    ## /rule: {{ $rn }}
{{-       end }}
{{-     end }}
{{    end}}{{/* end of range */}}
{{ end }}

{{ define "profile" }}
{{-   $profile := index . "" }}
{{-   $Cfg := index . "Cfg" }}

{{ end }}
