{{- define "virtual" }}
{{-  range $i, $v :=  index .Cfg.LtmVirtual -}}

{{      comment $v.Original 0 }}
frontend {{ $v.Name }}
    bind {{ ipport $v.Destination }}

{{      range $pi, $pn := index .Profiles }}
    ## profile: {{ $pn.Name }}
{{-        with index $.Cfg.LtmProfile $pn.Name }}
{{          comment .Original 4 }}
{{-         templateIfExists .Name . -}}
{{-        end }}
    ## /profile: {{ $pn.Name }}
{{      end}}

{{      range $ri, $rn := index .Rules }}
    ## rule: {{ $rn }}
{{-        with index $.Cfg.LtmRule $rn }}
{{          comment .Original 4 }}
{{-         templateIfExists .Name . -}}
{{-        end }}
    ## /rule: {{ $rn }}
{{      end}}
{{   end -}}
{{ end -}}
