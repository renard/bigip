{{ define "frontend" }}
{{-   $fe := index . "frontend" }}
{{-   $Cfg := index . "Cfg" }}
frontend {{ $fe.Name }}
    bind {{ ipport $fe.Destination }}

{{      range $pi, $pn := index $fe.Profiles }}
    ## profile: {{ $pn.Name }}
{{-        with index $Cfg.LtmProfile $pn.Name }}
    # {{ index .OriginalConfig.Lines 0 }}-{{ index .OriginalConfig.Lines 1 }}
{{          comment .Original 4 }}
{{-         templateIfExists $fe.Name . -}}
{{-        end }}
    ## /profile: {{ $pn.Name }}
{{      end}}

{{      range $ri, $rn := index $fe.Rules }}
    ## rule: {{ $rn }}
{{-        with index $Cfg.LtmRule $rn }}
{{          comment .Original 4 }}
{{-         templateIfExists $fe.Name . -}}
{{-        end }}
    ## /rule: {{ $rn }}
{{      end}}
{{ end }}


{{- define "virtual" }}
{{-  range $i, $v :=  index .Cfg.LtmVirtual -}}
{{     comment $v.Original 0 }}
{{-    template "frontend" (dict "frontend" $v "Cfg" $.Cfg ) -}}
{{   end -}}
{{ end -}}
